<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Keras transfer learning | Sim’s Pyimage</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Keras transfer learning" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Keras transfer learning" />
<meta property="og:description" content="Keras transfer learning" />
<link rel="canonical" href="https://simsisim.github.io/sims-pyimage/keras/2021/01/20/keras_transfer_leraning.html" />
<meta property="og:url" content="https://simsisim.github.io/sims-pyimage/keras/2021/01/20/keras_transfer_leraning.html" />
<meta property="og:site_name" content="Sim’s Pyimage" />
<meta property="og:image" content="https://simsisim.github.io/sims-pyimage/images/chart-preview.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-20T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Keras transfer learning","url":"https://simsisim.github.io/sims-pyimage/keras/2021/01/20/keras_transfer_leraning.html","@type":"BlogPosting","headline":"Keras transfer learning","dateModified":"2021-01-20T00:00:00-06:00","datePublished":"2021-01-20T00:00:00-06:00","image":"https://simsisim.github.io/sims-pyimage/images/chart-preview.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://simsisim.github.io/sims-pyimage/keras/2021/01/20/keras_transfer_leraning.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/sims-pyimage/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://simsisim.github.io/sims-pyimage/feed.xml" title="Sim's Pyimage" /><link rel="shortcut icon" type="image/x-icon" href="/sims-pyimage/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/sims-pyimage/">Sim&#39;s Pyimage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/sims-pyimage/about/">About Me</a><a class="page-link" href="/sims-pyimage/search/">Search</a><a class="page-link" href="/sims-pyimage/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Keras transfer learning</h1><p class="page-description">Keras transfer learning</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-01-20T00:00:00-06:00" itemprop="datePublished">
        Jan 20, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/sims-pyimage/categories/#Keras">Keras</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/simsisim/sims-pyimage/tree/master/_notebooks/2021-01-20-keras_transfer_leraning.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/sims-pyimage/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/simsisim/sims-pyimage/master?filepath=_notebooks%2F2021-01-20-keras_transfer_leraning.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/sims-pyimage/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/simsisim/sims-pyimage/blob/master/_notebooks/2021-01-20-keras_transfer_leraning.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/sims-pyimage/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#1.-Transfer-Learning:-Grundlagen-und-Einsatz-Gebiete">1. Transfer Learning: Grundlagen und Einsatz Gebiete </a></li>
<li class="toc-entry toc-h2"><a href="#2.-Methoden-für-Transfer-Learning">2. Methoden für Transfer Learning </a></li>
<li class="toc-entry toc-h2"><a href="#3.-Transfer-Learning-mit-ähnlichen-Daten-und-kleinem-Datensatz">3. Transfer Learning mit ähnlichen Daten und kleinem Datensatz </a></li>
<li class="toc-entry toc-h2"><a href="#4.-Transfer-Learning-mit-unterschiedlichen-Daten-und-kleinem-Datensatz">4. Transfer Learning mit unterschiedlichen Daten und kleinem Datensatz </a></li>
<li class="toc-entry toc-h2"><a href="#3.-Transfer-Learning-mit-Merkmahle-Extrahierung">3. Transfer Learning mit Merkmahle Extrahierung </a></li>
<li class="toc-entry toc-h2"><a href="#A.-Datensatz-Verzeichniss,-Datensatz-Verarbeitung">A. Datensatz Verzeichniss, Datensatz Verarbeitung </a></li>
<li class="toc-entry toc-h2"><a href="#B.-Model-laden">B. Model laden </a></li>
<li class="toc-entry toc-h2"><a href="#C.--Markmahle-extrahieren-und-speichern">C.  Markmahle extrahieren und speichern </a></li>
<li class="toc-entry toc-h2"><a href="#D.-CSV-Dateien-mit-gespeicherten-Merkmahlen-laden">D. CSV-Dateien mit gespeicherten Merkmahlen laden </a></li>
<li class="toc-entry toc-h2"><a href="#E.-Modell-für-classification">E. Modell für classification </a></li>
<li class="toc-entry toc-h2"><a href="#Referenzen:">Referenzen: </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-01-20-keras_transfer_leraning.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Transfer-Learning:-Grundlagen-und-Einsatz-Gebiete">
<a class="anchor" href="#1.-Transfer-Learning:-Grundlagen-und-Einsatz-Gebiete" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Transfer Learning: Grundlagen und Einsatz Gebiete<a class="anchor-link" href="#1.-Transfer-Learning:-Grundlagen-und-Einsatz-Gebiete"> </a>
</h2>
<ul>
<li>Transfer Learning ist ein Konzept aus dem Deep Learning, wo vortrainierte Modelle transferiert und in neuen Modellen zum Einsatz bringen</li>
<li>Unter Transfer-Learning versteht man das Übertragen der Ergebnisse eines fertig trainierten neuronalen Netzes auf eine neue Aufgabe</li>
</ul>
<p>Das Training eines neuen neuronalen Netzes mit einer größen Anzahl von Daten ist rechnenintersiv und zeitaufwändig. 
Wenn man ein neues neuronales Netz trainieren möchte, kann es daher sinnvoll sein, mit der Hilfe von Transfer Learning auf den bereits gelernten Features eines fertig trainierten Netzes aufzubauen. Dabei werden z.B. die fertig trainierten Layer eines CNN’s übernommen und nur der Output-Layer wird auf die Anzahl der zu erkennenden Objektklassen des neuen Netzes angepasst und nachtrainiert (Fine-Tuning).</p>
<h2 id="2.-Methoden-für-Transfer-Learning">
<a class="anchor" href="#2.-Methoden-f%C3%BCr-Transfer-Learning" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Methoden für Transfer Learning<a class="anchor-link" href="#2.-Methoden-f%C3%BCr-Transfer-Learning"> </a>
</h2>
<ul>
<li>Merkmahle-Extrahierung</li>
<li>Fine-Tuning</li>
</ul>
<h2 id="3.-Transfer-Learning-mit-ähnlichen-Daten-und-kleinem-Datensatz">
<a class="anchor" href="#3.-Transfer-Learning-mit-%C3%A4hnlichen-Daten-und-kleinem-Datensatz" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Transfer Learning mit ähnlichen Daten und kleinem Datensatz<a class="anchor-link" href="#3.-Transfer-Learning-mit-%C3%A4hnlichen-Daten-und-kleinem-Datensatz"> </a>
</h2>
<p>Wenn die zu erkenneden Objekte änlichen Strukturen aufweisen (Hunde vs. Katze) und für die neue Aufgabe nur ein kleiner Datensazt zur Verfügung steht, kann man einfach den Output-Layer durch einen neuen ersetzen, dessen Neuronen-Anzahl mit dem Anzahl der neu zu erkennenden Klassen entspricht.</p>
<p>Alle andere Layern werden beibehalten und nicht weiter tranniert. Der neune Output-Layer wird mit zufällig gewählten Gewichten initialisiert un mit den neuen Datensazt traniert. Dabei durchlaufen erstmal</p>
<h2 id="4.-Transfer-Learning-mit-unterschiedlichen-Daten-und-kleinem-Datensatz">
<a class="anchor" href="#4.-Transfer-Learning-mit-unterschiedlichen-Daten-und-kleinem-Datensatz" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Transfer Learning mit unterschiedlichen Daten und kleinem Datensatz<a class="anchor-link" href="#4.-Transfer-Learning-mit-unterschiedlichen-Daten-und-kleinem-Datensatz"> </a>
</h2>
<h2 id="3.-Transfer-Learning-mit-Merkmahle-Extrahierung">
<a class="anchor" href="#3.-Transfer-Learning-mit-Merkmahle-Extrahierung" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Transfer Learning mit Merkmahle Extrahierung<a class="anchor-link" href="#3.-Transfer-Learning-mit-Merkmahle-Extrahierung"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="c1">#from resnet import ResNet</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.applications</span> <span class="kn">import</span> <span class="n">ResNet50</span>
<span class="kn">from</span> <span class="nn">pysim</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelBinarizer</span><span class="p">,</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">imutils</span> <span class="kn">import</span> <span class="n">paths</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="c1">#from sklearn.linear_model import LogisticRegression</span>
<span class="c1">#from sklearn.metrics import classification_report</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="A.-Datensatz-Verzeichniss,-Datensatz-Verarbeitung">
<a class="anchor" href="#A.-Datensatz-Verzeichniss,-Datensatz-Verarbeitung" aria-hidden="true"><span class="octicon octicon-link"></span></a>A. Datensatz Verzeichniss, Datensatz Verarbeitung<a class="anchor-link" href="#A.-Datensatz-Verzeichniss,-Datensatz-Verarbeitung"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">TEST</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] processing '</span><span class="si">{}</span><span class="s2"> split'..."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">split</span><span class="p">))</span>
    <span class="n">imagePaths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">ORIG_INPUT_DATASET</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">imagePath</span> <span class="ow">in</span> <span class="n">imagePaths</span><span class="p">[:</span><span class="mi">96</span><span class="p">]:</span>
        <span class="n">filename</span> <span class="o">=</span>  <span class="n">imagePath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="c1">#new directory path</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_PATH</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">label</span><span class="p">])</span>
        <span class="c1"># if directory doesn't exist than creat new</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newPath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
        <span class="n">newPathFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">newPath</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">imagePath</span><span class="p">,</span> <span class="n">newPathFile</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[INFO] processing 'train split'...
[INFO] processing 'val split'...
[INFO] processing 'test split'...
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="B.-Model-laden">
<a class="anchor" href="#B.-Model-laden" aria-hidden="true"><span class="octicon octicon-link"></span></a>B. Model laden<a class="anchor-link" href="#B.-Model-laden"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">VGG16</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="s2">"imagenet"</span><span class="p">,</span> <span class="n">include_top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">le</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="C.--Markmahle-extrahieren-und-speichern">
<a class="anchor" href="#C.--Markmahle-extrahieren-und-speichern" aria-hidden="true"><span class="octicon octicon-link"></span></a>C.  Markmahle extrahieren und speichern<a class="anchor-link" href="#C.--Markmahle-extrahieren-und-speichern"> </a>
</h2>
<ul>
<li>Loop over all paths </li>
<li>Randommly shuffle paths</li>
<li>Construct csv files were features should be written</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">TEST</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] processing '</span><span class="si">{}</span><span class="s2"> split'..."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">split</span><span class="p">))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_PATH</span><span class="p">,</span> <span class="n">split</span><span class="p">])</span>
        <span class="n">imagePaths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">list_images</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="c1"># random shuffle the image paths and extract class labels for the file path</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">imagePaths</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">imagePaths</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">le</span> <span class="ow">is</span>  <span class="kc">None</span><span class="p">:</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
                <span class="n">le</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">cvsPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_CSV_PATH</span><span class="p">,</span> <span class="s2">"</span><span class="si">{}</span><span class="s2">.csv"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">split</span><span class="p">)])</span> 
        <span class="n">csv</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cvsPath</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">imagePaths</span><span class="p">),</span> <span class="n">config</span><span class="o">.</span><span class="n">BATCH_SIZE</span><span class="p">)):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] processing batch </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>\
                                        <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imagePaths</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">BATCH_SIZE</span><span class="p">)))))</span>
                    <span class="n">batchPaths</span> <span class="o">=</span> <span class="n">imagePaths</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">BATCH_SIZE</span><span class="p">]</span> 
                    <span class="n">batchLabels</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">BATCH_SIZE</span><span class="p">])</span>
                    <span class="n">batchImages</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c1"># loop over the images and labels in the current batch</span>
                    <span class="k">for</span> <span class="n">imagePath</span> <span class="ow">in</span> <span class="n">batchPaths</span><span class="p">:</span>
                    <span class="c1"># load the input image using the Keras helper utility</span>
                    <span class="c1"># while ensuring the image is resized to 224x224 pixels</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="n">imagePath</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">))</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">img_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                        <span class="c1"># preprocess the image by (1) expanding the dimensions and</span>
                        <span class="c1"># (2) subtracting the mean RGB pixel intensity from the ImageNet dataset</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">vgg16</span><span class="o">.</span><span class="n">preprocess_input</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                        <span class="c1"># add the image to the batch</span>
                        <span class="n">batchImages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> 
                    <span class="c1"># pass the images through the network and use the outputs a</span>
                    <span class="c1"># our actual features, then reshape the features into a flattened volume</span>
                    <span class="n">batchImages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">batchImages</span><span class="p">)</span>
                    <span class="n">features</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">batchImages</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
                    <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">512</span><span class="p">))</span>

                    <span class="c1"># loop over the class labels and extracted features</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">batchLabels</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
                        <span class="c1"># construct a row that exists of the class label and</span>
                        <span class="c1"># extracted features</span>
                        <span class="n">vec</span> <span class="o">=</span> <span class="s2">","</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">])</span>
                        <span class="n">csv</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">vec</span><span class="p">))</span>
<span class="c1"># close the CSV file</span>
        <span class="n">csv</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
<span class="c1"># serialize the label encoder to disk</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">LE_PATH</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">le</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">"Done"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[INFO] processing 'train split'...
[INFO] processing batch 1/3
[INFO] processing batch 2/3
[INFO] processing batch 3/3
[INFO] processing 'val split'...
[INFO] processing batch 1/3
[INFO] processing batch 2/3
[INFO] processing batch 3/3
[INFO] processing 'test split'...
[INFO] processing batch 1/3
[INFO] processing batch 2/3
[INFO] processing batch 3/3
Done
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="D.-CSV-Dateien-mit-gespeicherten-Merkmahlen-laden">
<a class="anchor" href="#D.-CSV-Dateien-mit-gespeicherten-Merkmahlen-laden" aria-hidden="true"><span class="octicon octicon-link"></span></a>D. CSV-Dateien mit gespeicherten Merkmahlen laden<a class="anchor-link" href="#D.-CSV-Dateien-mit-gespeicherten-Merkmahlen-laden"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainingPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_CSV_PATH</span><span class="p">,</span><span class="s2">"</span><span class="si">{}</span><span class="s2">.csv"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">)])</span>
<span class="n">testingPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_CSV_PATH</span><span class="p">,</span> <span class="s2">"</span><span class="si">{}</span><span class="s2">.csv"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">TEST</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trainingPath</span><span class="p">,</span> <span class="n">testingPath</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>output/train.csv output/test.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_data_split</span><span class="p">(</span><span class="n">splitPath</span><span class="p">):</span>
<span class="c1"># initialize the data and labels</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># loop over the rows in the data split file</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">splitPath</span><span class="p">):</span>
<span class="c1"># extract the class label and features from the row</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float"</span><span class="p">)</span>

<span class="c1"># update the data and label lists</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="c1"># convert the data and labels to NumPy arrays</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># return a tuple of the data and labels</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainingPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_CSV_PATH</span><span class="p">,</span><span class="s2">"</span><span class="si">{}</span><span class="s2">.csv"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">)])</span>
<span class="n">testingPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">config</span><span class="o">.</span><span class="n">BASE_CSV_PATH</span><span class="p">,</span><span class="s2">"</span><span class="si">{}</span><span class="s2">.csv"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">TEST</span><span class="p">)])</span>
<span class="c1"># load the data from disk</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] loading data..."</span><span class="p">)</span>
<span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">)</span> <span class="o">=</span> <span class="n">load_data_split</span><span class="p">(</span><span class="n">trainingPath</span><span class="p">)</span>
<span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">)</span> <span class="o">=</span> <span class="n">load_data_split</span><span class="p">(</span><span class="n">testingPath</span><span class="p">)</span>

<span class="c1"># load the label encoder from disk</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">LE_PATH</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[INFO] loading data...
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="E.-Modell-für-classification">
<a class="anchor" href="#E.-Modell-f%C3%BCr-classification" aria-hidden="true"><span class="octicon octicon-link"></span></a>E. Modell für classification<a class="anchor-link" href="#E.-Modell-f%C3%BCr-classification"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] training model..."</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s2">"lbfgs"</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">)</span>

<span class="c1"># evaluate the model</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] evaluating..."</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">testY</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">classes_</span><span class="p">))</span>

<span class="c1"># serialize the model to disk</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] saving model..."</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">MODEL_PATH</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[INFO] training model...
[INFO] evaluating...
              precision    recall  f1-score   support

        food       1.00      0.94      0.97        51
    non_food       0.94      1.00      0.97        45

    accuracy                           0.97        96
   macro avg       0.97      0.97      0.97        96
weighted avg       0.97      0.97      0.97        96

[INFO] saving model...
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Referenzen:">
<a class="anchor" href="#Referenzen:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Referenzen:<a class="anchor-link" href="#Referenzen:"> </a>
</h2>
<blockquote>
<p>Adrian Rosebrock, OpenCV Face Recognition, PyImageSearch, <a href="https://www.pyimagesearch.com/">https://www.pyimagesearch.com/</a>, accessed on 3 January, 2021&gt; www:<a href="https://www.pyimagesearch.com/2019/05/20/transfer-learning-with-keras-and-deep-learning/&gt;">https://www.pyimagesearch.com/2019/05/20/transfer-learning-with-keras-and-deep-learning/&gt;</a> www:<a href="https://jaai.de/transfer-learning-1739/&gt;">https://jaai.de/transfer-learning-1739/&gt;</a> www:<a href="https://user.phil.hhu.de/~petersen/SoSe17_Teamprojekt/AR/neuronalenetze.html">https://user.phil.hhu.de/~petersen/SoSe17_Teamprojekt/AR/neuronalenetze.html</a></p>
</blockquote>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="simsisim/sims-pyimage"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/sims-pyimage/keras/2021/01/20/keras_transfer_leraning.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/sims-pyimage/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/sims-pyimage/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/sims-pyimage/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/simsisim" title="simsisim"><svg class="svg-icon grey"><use xlink:href="/sims-pyimage/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
